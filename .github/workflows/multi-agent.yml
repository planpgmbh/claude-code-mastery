# GitHub Actions Multi-Agent Workflow

name: Multi-Agent Development Workflow

on:
  issues:
    types: [opened, labeled, assigned]
  pull_request:
    types: [opened, synchronize, closed]
  project_card:
    types: [moved]

jobs:
  issue-automation:
    runs-on: ubuntu-latest
    if: github.event_name == 'issues'
    steps:
      - name: Add to Project Board
        uses: alex-page/github-project-automation-plus@v0.8.1
        with:
          project: Main Development Board
          column: Backlog
          repo-token: ${{ secrets.GITHUB_TOKEN }}
          
      - name: Auto-approve Bug Reports
        if: contains(github.event.issue.labels.*.name, 'bug')
        uses: alex-page/github-project-automation-plus@v0.8.1
        with:
          project: Main Development Board
          column: Ready
          repo-token: ${{ secrets.GITHUB_TOKEN }}

      - name: Analysis Agent Notification
        if: contains(github.event.issue.labels.*.name, 'analysis-required')
        uses: peter-evans/create-or-update-comment@v3
        with:
          issue-number: ${{ github.event.issue.number }}
          body: |
            ## 🤖 Analysis Agent aktiviert
            
            Dieses Issue wurde automatisch zur **Analysis Agent Pipeline** hinzugefügt.
            
            **Next Steps:**
            1. 🔍 **Analysis Agent** wird das Issue analysieren
            2. 📋 **Technical Specification** wird erstellt
            3. ➡️ **Automatischer Transfer** zur "Ready" Spalte
            4. 👤 **Human Review** vor Implementation
            
            **Estimated Analysis Time:** 5-15 Minuten
            
            ---
            *🤖 Powered by Claude Code Multi-Agent System*

  pr-automation:
    runs-on: ubuntu-latest
    if: github.event_name == 'pull_request'
    steps:
      - name: Move to Testing
        if: github.event.action == 'opened'
        uses: alex-page/github-project-automation-plus@v0.8.1
        with:
          project: Main Development Board
          column: Testing
          repo-token: ${{ secrets.GITHUB_TOKEN }}
          
      - name: Move to Done
        if: github.event.action == 'closed' && github.event.pull_request.merged == true
        uses: alex-page/github-project-automation-plus@v0.8.1
        with:
          project: Main Development Board
          column: Done
          repo-token: ${{ secrets.GITHUB_TOKEN }}

      - name: Implementation Agent Success
        if: github.event.action == 'closed' && github.event.pull_request.merged == true
        uses: peter-evans/create-or-update-comment@v3
        with:
          issue-number: ${{ github.event.pull_request.number }}
          body: |
            ## 🎉 Implementation Agent - Mission Accomplished!
            
            **✅ Successfully Merged:**
            - 🤖 **Implementation Agent** completed the task
            - 🧪 **All tests** passed
            - 🚀 **Ready for deployment**
            
            **Metrics:**
            - **Files Modified:** ${{ github.event.pull_request.changed_files }}
            - **Lines Added:** +${{ github.event.pull_request.additions }}
            - **Lines Removed:** -${{ github.event.pull_request.deletions }}
            
            **🔄 Automated Actions:**
            - ✅ Issue moved to "Done"
            - 🚀 Deployment pipeline triggered
            - 📊 Metrics updated
            
            ---
            *🤖 Multi-Agent Mission Complete | 👤 Human oversight maintained*

  project-automation:
    runs-on: ubuntu-latest
    if: github.event_name == 'project_card'
    steps:
      - name: Implementation Agent Trigger
        if: github.event.project_card.column_name == 'To Do'
        uses: peter-evans/repository-dispatch@v2
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          event-type: implementation-agent-trigger
          client-payload: |
            {
              "issue_number": "${{ github.event.project_card.content_url }}",
              "column": "To Do",
              "action": "start_implementation"
            }
